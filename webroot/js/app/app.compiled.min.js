System.registerModule("config",[],function(){"use strict";var e=!0,t=60,r="js/app/assets/";return{get _DEBUG_MODE_(){return e},get _FPS_(){return t},get _ASSETS_PATH_(){return r}}}),System.registerModule("util",[],function(){"use strict";function e(e){if(h._DEBUG_MODE_){var r=new Date,n=t(r.getHours()),i=t(r.getMinutes()),o=t(r.getSeconds()),a=t(r.getMilliseconds()),s=n+":"+i+":"+o+":"+a;console.log(s+" "+e)}}function t(e){return("0"+e).slice(-2)}function r(e){if(h._DEBUG_MODE_){var r=new Date,n=t(r.getHours()),i=t(r.getMinutes()),o=t(r.getSeconds()),a=t(r.getMilliseconds()),s=n+":"+i+":"+o+":"+a;$("#debug_board").html(s+" "+e)}}function n(e){var t=e.context,r={Version:t.getParameter(t.VERSION),"Shading language":t.getParameter(t.SHADING_LANGUAGE_VERSION),Vendor:t.getParameter(t.VENDOR),Renderer:t.getParameter(t.RENDERER),"Max varying vectors":t.getParameter(t.MAX_VARYING_VECTORS),"Max vertex attribs":t.getParameter(t.MAX_VERTEX_ATTRIBS),"Max vertex uniform vectors":t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),"Max fragment uniform vectors":t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),"Max renderbuffer size":t.getParameter(t.MAX_RENDERBUFFER_SIZE),"Max texture size":t.getParameter(t.MAX_TEXTURE_SIZE),"Max cube map texture size":t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),"Max texture image units":t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),"Max vertex texture units":t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),"Max combined texture units":t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),"Max viewport dims":t.getParameter(t.MAX_VIEWPORT_DIMS)[0]+"x"+t.getParameter(t.MAX_VIEWPORT_DIMS)[1]};console.log("WebGL info: ",r)}function i(e,t){var r=t?"image/jpeg":"image/png",n=renderer.domElement.toDataURL(r);e||(n=n.replace(r,"image/octet-stream")),window.open(n,"_blank")}function o(e,t,r,n,i){var o=$("<div>"+e+"</div>"),a={};a[r]=function(){$(this).dialog("close"),i(!1),$(this).dialog("destroy")},a[n]=function(){$(this).dialog("close"),i(!0),$(this).dialog("destroy")},o.dialog({modal:!0,draggable:!0,title:t,height:180,width:500,buttons:a,open:function(){var e=$(".ui-dialog-titlebar-close");e.append('<span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span>')},overlay:{opacity:.3,background:"#225b7f"}})}function a(e,t,r,n,i){var o=$("<div>"+e+"</div>"),a={};a[r]=function(){$(this).dialog("close"),i(!1),$(this).dialog("destroy")},a[n]=function(){$(this).dialog("close"),i(!0),$(this).dialog("destroy")},o.dialog({modal:!0,draggable:!0,title:t,width:500,buttons:a,open:function(){var e=$(".ui-dialog-titlebar-close");e.append('<span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span><span class="ui-button-text">close</span>')},overlay:{opacity:.3,background:"#225b7f"}})}function s(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,s)}function c(e){$.i18n.init({ns:{namespaces:["ns.special"],defaultNs:"ns.special"},useLocalStorage:!1,debug:!0},function(){e()})}var h=System.get("config"),u=function(){};return $traceurRuntime.createClass(u,{hoge:function(e){console.log("Hoge::hoge "+e)}},{}),{get trace_func(){return e},get debug_board(){return r},get webgl_info(){return n},get screenshot(){return i},get Hoge(){return u},get confirmDialog(){return o},get myDialog(){return a},get uuid(){return s},get i18nLoad(){return c}}}),System.registerModule("objects/debugbox",[],function(){"use strict";var e=System.get("util"),t=(System.get("config"),function(t){e.trace_func("Debugbox::constructor"),this.callback_function=t,this.mesh=new THREE.Mesh(new THREE.BoxGeometry(100,100,100),new THREE.MeshPhongMaterial({color:65280})),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.callback_function(this.mesh)});return $traceurRuntime.createClass(t,{rendering:function(e){this.mesh.rotation.y+=e}},{}),{get Debugbox(){return t}}}),System.registerModule("objects/debugfloor",[],function(){"use strict";var e=System.get("util"),t=(System.get("config"),function(t){e.trace_func("Debugbox::constructor"),this.callback_function=t,this.mesh=new THREE.Mesh(new THREE.PlaneGeometry(1e3,1e3),new THREE.MeshPhongMaterial({color:14737632})),this.mesh.rotation.x=Math.PI+Math.PI/2,this.mesh.receiveShadow=!0,this.callback_function(this.mesh)});return $traceurRuntime.createClass(t,{rendering:function(){}},{}),{get Debugfloor(){return t}}}),System.registerModule("objects/enemies",[],function(){"use strict";var e=System.get("util"),t=System.get("config"),r=function(t,r){e.trace_func("Sprite::constructor"),this.callback_function=r,this.sprite=this.makeTextSprite(t,{fontsize:24,borderColor:{r:255,g:0,b:0,a:1},backgroundColor:{r:255,g:100,b:100,a:.8}}),this.callback_function(this.sprite)};$traceurRuntime.createClass(r,{getSprite:function(){return this.sprite},setPositionVector3:function(e){this.sprite.position.set(e.x,e.y,e.z)},setPosition:function(e,t,r){this.sprite.position.set(e,t,r)},rendering:function(){},updateSprite:function(e,t){void 0===t&&(t={});var r=(t.hasOwnProperty("fontface")?t.fontface:"Arial",t.hasOwnProperty("fontsize")?t.fontsize:18),n=t.hasOwnProperty("borderThickness")?t.borderThickness:4,i=t.hasOwnProperty("borderColor")?t.borderColor:{r:0,g:0,b:0,a:1},o=t.hasOwnProperty("backgroundColor")?t.backgroundColor:{r:255,g:255,b:255,a:1},a=this.context.measureText(e),s=a.width;this.context.fillStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",this.context.strokeStyle="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",this.context.lineWidth=n,this.roundRect(this.context,n/2,n/2,s+n,1.4*r+n,6),this.context.fillStyle="rgba(0, 0, 0, 1.0)",this.context.fillText(e,n,r+n),this.texture.needsUpdate=!0},makeTextSprite:function(e,t){void 0===t&&(t={});var r=t.hasOwnProperty("fontface")?t.fontface:"Arial",n=t.hasOwnProperty("fontsize")?t.fontsize:18,i=t.hasOwnProperty("borderThickness")?t.borderThickness:4,o=t.hasOwnProperty("borderColor")?t.borderColor:{r:0,g:0,b:0,a:1},a=t.hasOwnProperty("backgroundColor")?t.backgroundColor:{r:255,g:255,b:255,a:1},s=document.createElement("canvas");this.context=s.getContext("2d"),this.context.font="Bold "+n+"px "+r;var c=this.context.measureText(e),h=c.width;this.context.fillStyle="rgba("+a.r+","+a.g+","+a.b+","+a.a+")",this.context.strokeStyle="rgba("+o.r+","+o.g+","+o.b+","+o.a+")",this.context.lineWidth=i,this.roundRect(this.context,i/2,i/2,h+i,1.4*n+i,6),this.context.fillStyle="rgba(0, 0, 0, 1.0)",this.context.fillText(e,i,n+i),this.texture=new THREE.Texture(s),this.texture.needsUpdate=!0;var u=new THREE.SpriteMaterial({map:this.texture,useScreenCoordinates:!1}),d=new THREE.Sprite(u);return d.scale.set(100,50,1),d},roundRect:function(e,t,r,n,i,o){e.beginPath(),e.moveTo(t+o,r),e.lineTo(t+n-o,r),e.quadraticCurveTo(t+n,r,t+n,r+o),e.lineTo(t+n,r+i-o),e.quadraticCurveTo(t+n,r+i,t+n-o,r+i),e.lineTo(t+o,r+i),e.quadraticCurveTo(t,r+i,t,r+i-o),e.lineTo(t,r+o),e.quadraticCurveTo(t,r,t+o,r),e.closePath(),e.fill(),e.stroke()}},{});var n=function(){this.name="",this.maxhp=100,this.hp=100,this.maxmp=0,this.mp=0,this.maxammo=10,this.ammo=10,this.status=null,this.character=null,this.target_positions_array=null,this.target_position_index=0,this.current_animation="idol",this.sprite=null};$traceurRuntime.createClass(n,{calcDistance:function(e,t,r,n){var i,o,a;return i=e-r,o=t-n,a=Math.sqrt(Math.pow(i,2)+Math.pow(o,2))},rendering:function(e){var t=new THREE.Vector3(this.target_positions_array[this.target_position_index].x,this.character.root.position.y,this.target_positions_array[this.target_position_index].z);this.character.root.lookAt(t);var r=this.calcDistance(this.character.root.position.x,this.character.root.position.z,t.x,t.z),n=200*e/3;this.character.root.translateZ(n),10>r&&(this.target_position_index+1>=this.target_positions_array.length?this.target_position_index=0:this.target_position_index++),this.sprite.updateSprite(" "+this.name+" HP:"+this.hp--+"/"+this.maxhp+" ",{fontsize:24,borderColor:{r:255,g:0,b:0,a:1},backgroundColor:{r:255,g:100,b:100,a:.8}}),this.sprite.setPosition(this.character.root.position.x,this.character.root.position.y+30,this.character.root.position.z),this.character.update(e)}},{});var i=function(i,o){e.trace_func("Enemies::constructor");var a={baseUrl:t._ASSETS_PATH_+"models/ogro/",body:"ogro-light.js",skins:["grok.jpg","ogrobase.png","arboshak.png","ctf_r.png","ctf_b.png","darkam.png","freedom.png","gib.png","gordogh.png","igdosh.png","khorne.png","nabogro.png"],weapons:[["weapon-light.js","weapon.jpg"]],animations:{move:"run",idle:"stand",jump:"jump",attack:"attack",crouchMove:"cwalk",crouchIdle:"cstand",crouchAttach:"crattack"},walkSpeed:350,crouchSpeed:175},s={moveForward:!1,moveBackward:!1,moveLeft:!1,moveRight:!1};this.callback_function=o,this.characters=new Array,this.cloneCharacterRoots=new Array,this.sprites=new Array;for(var c=0;i>c;c++){var h=new THREE.MD2CharacterComplex;h.scale=1,h.controls=s;var u=new n;u.character=h,u.target_positions_array=new Array;for(var d=0;3>d;d++){var l=Math.floor(1e3*Math.random())-500,g=Math.floor(1e3*Math.random())-500;u.target_positions_array.push({x:l,z:g})}u.name="モンスター"+c;var m=new r(" "+u.name+" HP:"+u.hp+"/"+u.maxhp+" ",function(){});u.sprite=m,this.characters.push(u)}var f=new THREE.MD2CharacterComplex;f.scale=3;var p=this;f.onLoadComplete=function(){for(var e=0;i>e;e++){var t=p.characters[e].character;t.shareParts(f),t.enableShadows(!0),t.setWeapon(0),t.setSkin(e),t.frontAcceleration=0,t.controls.moveForward=!0,t.root.position.x=150*e-500,t.root.position.y=25,t.root.position.z=150*e-500,p.cloneCharacterRoots.push(t.root),p.sprites.push(p.characters[e].sprite.getSprite())}p.callback_function(p.cloneCharacterRoots,p.sprites)},f.loadParts(a)};return $traceurRuntime.createClass(i,{rendering:function(e){for(var t=0;t<this.characters.length;t++)this.characters[t].rendering(e)}},{}),{get Enemies(){return i}}}),System.registerModule("objects/shaderbox",[],function(){"use strict";var e=System.get("util"),t=System.get("config"),r=function(r,n,i){e.trace_func("Shaderbox::constructor"),this.callback_function=i;var o=new THREE.ImageUtils.loadTexture(t._ASSETS_PATH_+"Three.js-code-example.jpg"),a=!0,s=!1,c=!1;a===!0?s=!0:c=!0,this.customUniforms={baseTexture:{type:"t",value:o},time:{type:"f",value:1},grayscale:{type:"i",value:c},sepia:{type:"i",value:s}};var h=new THREE.ShaderMaterial({uniforms:this.customUniforms,vertexShader:r,fragmentShader:n});this.mesh=new THREE.Mesh(new THREE.BoxGeometry(100,100,100),h),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0,this.callback_function(this.mesh)};return $traceurRuntime.createClass(r,{rendering:function(e){this.mesh.rotation.y+=e,this.customUniforms.time.value+=e}},{}),{get Shaderbox(){return r}}}),System.registerModule("testscene",[],function(){"use strict";var e=System.get("util"),t=(System.get("config"),System.get("objects/debugbox")),r=System.get("objects/shaderbox"),n=System.get("objects/debugfloor"),i=System.get("objects/enemies"),o=!0,a=function(t){e.trace_func("TestScene::constructor"),this.renderer,this.scene,this.camera,this.light,this.ambient,this.all_items=4,this.loaded_items=0,this.render_target_array=new Array,this.clock,this.renderer=t,this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(45,1,.1,1e5),this.camera.position.set(0,150,500),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.light=new THREE.SpotLight(16777215),this.light.position.set(100,1e3,0),this.light.angle=Math.PI/4,this.scene.add(this.light),this.ambient=new THREE.AmbientLight(3355443),this.scene.add(this.ambient),this.light.castShadow=!0,this.light.shadowMapWidth=1024,this.light.shadowMapHeight=1024,this.light.shadowCameraNear=100,this.light.shadowCameraFar=1100,this.light.shadowCameraFov=30,this.light.shadowCameraVisible=!0,this.renderer.shadowMapEnabled=!0,this.loadObjects(),o&&(this.trackball=new THREE.TrackballControls(this.camera))};return $traceurRuntime.createClass(a,{getLoadingStatus:function(){return this.all_items===this.loaded_items||0==this.loading?!0:!1},loadedIncrements:function(){this.loaded_items++,this.loaded_items===this.all_items&&(this.loading=!1,this.clock=new THREE.Clock)},rendering:function(){o&&this.trackball.update();for(var t=this.clock.getDelta(),r=0;r<this.render_target_array.length;r++)this.render_target_array[r].rendering(t);e.debug_board("delta: "+Math.floor(1e5*t)/1e5+"<br>info.memory.programs:"+this.renderer.info.memory.programs+"<br>info.memory.geometries:"+this.renderer.info.memory.geometries+"<br>info.memory.textures:"+this.renderer.info.memory.textures+"<br>info.render.calls:"+this.renderer.info.render.calls+"<br>info.render.vertices:"+this.renderer.info.render.vertices+"<br>info.render.faces:"+this.renderer.info.render.faces+"<br>info.render.points:"+this.renderer.info.render.points),this.renderer.render(this.scene,this.camera)},loadObjects:function(){var e=this,o=new t.Debugbox(function(t){t.position.y+=70,e.scene.add(t),e.loadedIncrements()});this.render_target_array.push(o),SHADER_LOADER.load(function(t){var n=t.vertexShader.vertex,i=t.fragmentShader.fragment,o=new r.Shaderbox(n,i,function(t){t.position.y+=70,t.position.x+=120,e.scene.add(t),e.loadedIncrements()});e.render_target_array.push(o)});var a=new n.Debugfloor(function(t){e.scene.add(t),e.loadedIncrements()});this.render_target_array.push(a);var s=new i.Enemies(10,function(t,r){for(var n=0;n<t.length;n++)e.scene.add(t[n]);for(var n=0;n<r.length;n++)e.scene.add(r[n]);e.loadedIncrements()});this.render_target_array.push(s)},resize:function(){e.trace_func("TestScene::resize"),this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix()}},{}),{get TestScene(){return a}}}),System.registerModule("app.js",[],function(){"use strict";var e=System.get("util"),t=System.get("config"),r=System.get("testscene"),n=function(){e.trace_func("App::constructor"),this.renderer,this.stats,this.currentSceneObject,this.renderer=Detector.webgl?new THREE.WebGLRenderer({antialias:!0}):new THREE.CanvasRenderer,Detector.webgl&&e.webgl_info(this.renderer);var n=window.innerWidth,i=window.innerHeight;this.renderer.setSize(n,i),this.renderer.setClearColor(0,1),document.getElementById("canvas").appendChild(this.renderer.domElement),this.stats=new Stats,this.stats.domElement.style.position="absolute",this.stats.domElement.style.top="0px",this.stats.domElement.style.zIndex=100,document.body.appendChild(this.stats.domElement),t._DEBUG_MODE_&&(document.body.appendChild(this.stats.domElement),$(document.body).append('<div id="debug_board" width="200" height="200">test<br>test2<br>test3<br></div')),this.currentSceneObject=new r.TestScene(this.renderer),this.resize()};return $traceurRuntime.createClass(n,{run:function(){e.trace_func("App::run"),this.update()},update:function(){this.rendering(),this.stats.update()},rendering:function(){var e=this;60===t._FPS_?requestAnimationFrame(function(){e.update()}):setTimeout(function(){requestAnimationFrame(function(){e.update()})},1e3/t._FPS_),this.currentSceneObject.getLoadingStatus()===!0&&this.currentSceneObject.rendering()},resize:function(){var t=this;e.trace_func("App::resize"),$(window).resize(function(){var r=window.innerWidth,n=window.innerHeight;e.trace_func("App::resize::resize w:"+r+",h:"+n),t.renderer.setSize(r,n),t.currentSceneObject.resize()})}},{}),$(function(){e.i18nLoad(function(){e.trace_func($.i18n.t("app.i18nLoadComplete"));var t=new n;t.run()})}),{}}),System.get("app.js");